image: archlinux

packages:
- arm-none-eabi-gcc
- arm-none-eabi-newlib
- clang
- lib32-glibc
- sccache-bin

sources:
- https://github.com/nickray/littlefs2

tasks:

- rust: |
    curl -sSf https://sh.rustup.rs | sh -s -- -y -q
    echo "export RUSTC_WRAPPER=/usr/bin/sccache" >> $HOME/.cargo/env
    source $HOME/.cargo/env
    rustup target add thumbv7em-none-eabi

- build-thumb: |
    cd littlefs2
    source $HOME/.cargo/env
    RUSTFLAGS="-D warnings" cargo build --target thumbv7em-none-eabi
    RUSTFLAGS="-D warnings" cargo build --target thumbv7em-none-eabi --release

- build-desktop: |
    cd littlefs2
    source $HOME/.cargo/env
    RUSTFLAGS="-D warnings" cargo build
    RUSTFLAGS="-D warnings" cargo build --release

- test-desktop: |
    cd littlefs2
    source $HOME/.cargo/env
    cargo test
    cargo test --release
